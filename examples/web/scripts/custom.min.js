(function() {
    if (!Contentstack) {
        alert('Please add Contentstack Library');
    } else {
        var clearAll = document.getElementById('all');
        var clearByContentType = document.getElementById('content_type');
        var clearByQuery = document.getElementById('query');
        var wrapper, Stack;

        function DOMCreation(entry, html) {
            if (entry) {
                html += '<div class="panel panel-default"><div class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion" href="#' + entry.uid + '" aria-expanded="true" aria-controls="' + entry.uid + '">';
                html += entry.title + '</a></h4></div><div id="' + entry.uid + '" class="panel-collapse collapse" role="tabpanel"><div class="panel-body">';
                html += entry.url + ' </div></div></div>';
            }
            return html;
        }

        function singleEntry(contentTypeUid, entryUid) {
            var contentTypeUid = contentTypeUid || "news"
            var entryUid = entryUid || "news_uid"

            Stack
                .ContentType(contentTypeUid)
                .Entry(entryUid)
                .fetch()
                .then(function(data) {
                    // result object with entry
                    var html = '<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">';
                    html = DOMCreation(data.toJSON(), html);
                    html += '</div>';
                    wrapper.innerHTML = html;
                }, function(err) {
                    console.info('News could not fetched.');
                });
        }

        function allEntries(contentTypeUid) {
            var contentTypeUid = contentTypeUid || "news";
            Stack
                .ContentType(contentTypeUid)
                .Query()
                .find()
                .then(function(data) {
                    console.log("html webbrowser-------", data)
                    return 0;
                    if (data && data.length && data[0].length) {
                        var html = '<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">';
                        for (var i = 0, _i = data[0].length; i < _i; i++) {
                            html = DOMCreation(data[0][i].toJSON(), html);
                        }
                        html += '</div>';
                        wrapper.innerHTML = html;
                    } else {
                        console.info('News could not fetched.');
                    }
                }, function(err) {
                    console.info('Error : ' + err);
                });
        }

         function getSyncApi() {
            var contentTypeUid = contentTypeUid || "news";
            Stack
                .syncApi({"init" : "true"})
                .toJSON()
                .fetch()
                .then(function(data) {
                     console.log("html webbrowser-------", data[0])  
                     let result = data[0];
                     if (result && result.length && result.length) {
                        let assets = [];
                        let _assets = localStorage.getItem("Assets");
                        if(_assets) {
                            console.log("inside assets")
                            try{
                                assets = JSON.parse(_assets)
                            } catch(err) {
                                console.log(err)
                            }
                        }
                        
                        for (i = 0; i < result.length; i++) {
                             if(result[i].type === "asset_published") {
                            if(assets.length > 0) {
                                var flag = false;
                                for (j = 0; j < assets.length; j++) {
                                    let assets_result = [];
                                    if(assets[j].data.uid === result[i].data.uid) {
                                         flag = true;   
                                    }
                                }
                                if(flag !== true) {
                                    assets.push(result[i])
                                }
                            } 
                            else {
                                assets.push(result[i])
                            }
                        }
                        }

                        localStorage.setItem("Assets", JSON.stringify(assets));

                        console.log("asssetststststs", assets)    

                     }
                  //let result = data[0];
                     // if (result && result.length && result.length) {

                     //    let assets = [];
                     //    let _content_type = [];
                     //    let _assets = localStorage.getItem("Assets");
                        
                     //    if(_assets) {
                     //        try{
                     //            assets = JSON.parse(_assets)
                     //        } catch(err) {
                     //            console.log(err)
                     //        }
                     //    }  

                     //    for (i = 0; i < result.length; i++) {
                     //        if(result[i].type === "asset_published") {
                     //            assets.push(result[i])                                                                          
                     //        }
                     //         else if(result[i].type === "entry_published") {
                     //            let content_type = localStorage.getItem(result[i].content_type_uid);
                     //              if(content_type) {
                     //                 try{
                     //                    _content_type = JSON.parse(content_type)
                     //                } catch(err) {
                     //                    console.log(err)
                     //                }

                     //            } else {
                     //                _content_type.push(result[i])
                     //            }
                                
                     //        }
                     //    }
                     //     localStorage.setItem("Assets", JSON.stringify(assets));
                     //     localStorage.setItem("Entries", JSON.stringify(entries));
                     // } 

                //     if (data && data.length && data[0].length) {
                //         var html = '<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">';
                //         for (var i = 0, _i = data[0].length; i < _i; i++) {
                //             html = DOMCreation(data[0][i].toJSON(), html);
                //         }
                //         html += '</div>';
                //         wrapper.innerHTML = html;
                //     } else {
                //         console.info('News could not fetched.');
                //     }
                // }, function(err) {
                //     console.info('Error : ' + err);
                // });
        });
    }
    



    //  *
    //  * fetchAsset
    //  * @description  : fetchAsset is used to get the specified uid asset
    //  * @params       : assetUid       {string} - Specified Asset uid to be fetched                 
    //  * @return       : Result {Promise}
     
    // getSyncApi(key, value) {
    //     return this.Stack.Sync_Api(key, value);
    // }



        function getAsset() {
            Stack
                .Assets()
                .Query()
                .toJSON()
                .find()
                .spread(function(result) {
                    console.log("Result: ", result);
                    // result object with entry
                    console.info("Result2 : ", result)
                    for (let i = 0, _i = result.length; i < _i; i++) {
                        // Image optimization
                        const imgUrl = Stack.imageTransform(result[i]['url'], {
                            quality: 50,
                            format: 'jpg'
                        })
                        console.log("Image URL : ", imgUrl)
                    }
                }, function(err) {
                    // body...
                    console.info("Error: " + err);
                });
        }



        window.onload = function() {
            wrapper = document.getElementById('wrapper')
            Stack = Contentstack.Stack({ 'api_key': 'blta9acacf9a6d0813f', 'access_token': 'blt14773da40e15cddf', 'environment': 'development' })

            // get single the entry
            // singleEntry("source", "blt123something")

            // get all the entries
            getSyncApi()

            // get all the assets
            //getAsset();
        }
    }
}());